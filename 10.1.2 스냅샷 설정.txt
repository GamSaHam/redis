레디스는 데이터를 영구 저장하기 위해서 dump.rdb 파일에 메모리 내용을 기록한다.

save
레디스의 스냅샷 이벤트가 발생하는 간격을 지정하는 설정이다.
레디스는 스냅샷 이벤트가 발생하면 메모리에 저자오딘 데이터를 dump.rdb 파일에 저장한다.

save <단위시간> <키의 변경횟수>

save 300 10

300초 동안 최소 10개의 키가 변경되면 스냅샷 이벤트를 발생 시킨다.

save 900 1
save 300 10
save 60 10000

여러개의 save 설정을 지정할수 있다. 이중 하나의 조건이라도 만족하면 스냅샷 이벤트가 발생하게 된다.

save "" 빈 문자열을 지정하면 스냅샷 이벤트가 발생하지 않는다.

stop-writes-on-bgsave-error
스냅샷 이벤트에 의해서 dump.rdb 파일에 저장하는 도중에 오류가 발생하면 레디스는 모든 쓰기 요청을 거부한다.
예를 들어 물리적 디스크 오류가 발생하거나 디스크의 여유 공간 부족 상황에서 이와 같은 오류가 발생한다.

레디스는 dump.rdb 파일 저장에 실패하면 set, lpush, hset 같이 데이터 기록하는 모든 연산에 대해서 실패 응답을
반환한다.

스냅샷 파일생성에 실패하더라도 쓰기 요청을 처리하고 싶다면 stop-writes-on-bgsave-erorr 설정을 no로 지정한다.

rdbcompression
스냅샷 파일의 저장할 때 파일의 압축 여부를 설정한다. 
압축을 사용하지 않으면 스냅샷이 동작할 때의 CPU의 사용률이 높아 진다.

압축에 사용되는 알고리즘은 LZH이다.

rdbchecksum
스냅샷 파일을 저장할 때 파일의 정합성을 검증하기 위한 체크섬 사용 여부
rdbchecksum 설정의 값을 yes로 설정하면 스냅샷 파일을 생성하거나 읽을 때 10% 정도의 성능 하락이 발생한다.

dir
레디스 작업 디렉터리를 저정한다. 스냅샷 파일은 dump.rdb, aof 파일 로그파일이 해당된다.

dbfilename
스냅샷 파일의 파일명을 지정하는 설정이다. 기본값은 dump.rdb로 되어 있다.

지정된 경로가 존재하지 않으면 스냅샷 파일의 저장은 실패하게 되고, 이때 stop-writes-on-bgsave-error 설정값이
yes로 지정되어 있으면 모든 쓰기 요청이 거부된다

AOF
스냅샷이 설정되어 있을 때 레데시에 장애가 발생하면 최종 스냅샷 파일이 저장된 이후 데이터 변경 내역을
잃어 버리게 된다. 그러므로 스냅샷 만으로는 데이터 유실을 막을수 없다. 
AOF 파일은 레디스에서 발생한 모든 데이터의 변경 이력을 저장하고 있는데, 쓰기 명령어가 실행될 때마다
AOF 파일에 명령과 데이터를 기록하여 장애에서 데이터를 복원하는 데 사용한다.

appendonly
AOF 기능의 사용 여부를 설정한다. 기본값은 no이다.

appendfilename
aof 파일의 파일명을 지정한다.

appendfsync
일반적으로 운영체제의 고수준 파일 출력 함수들은 출력 버퍼에 기록을 완료하는 것으로 그 소임을 마친다.

레디스의 appendfsync 설정은 레디스가 aof 파일을 작성할 때 fsync 함수를 호출하는 정책에 대한 내용이다.

no: 레디스가 fsync 함수를 호출하지 않는다. 즉, OS가 알아서 파일에 저장하도록 한다. 

always: 각 명령어를 aof 파일에 기록하고 나서 항상 fsync 함수를 호출한다. 가장 느린 성능을 제공하지만 데이터 안정성
측면에서는 가장 좋다.

everysec: 매 초마다 fsync 함수를 호출한다. 성능과 안정성의 타협점으로 볼 수 있으며 레디스의 기본 설정 값이다.

어떤 설정값을 써야 할지 명확하지 않다면 everysec를 사용하는 것이 최선의 선택이다.

no-appendfsync-on-rewrite
appendfsync 설정값이 always나 everysec로 지정되어 있는 상태에서 AOF 또는 스냅샷을 생성하기 위한
백그라운드 프로세스가 동작하면 운영체제가 fsync 함수를 블록시킬 수도 있다.
이럴 때 최대 30초간 aof 파일에 데이터를 기록하지 못할 수 있다.

yes로 지정하면 운영체제가 fsync를 알아서 호출하도록 한다. 만약 데이터의 안정성보다 응답시간이 중요하면
yes로 지정하자 









