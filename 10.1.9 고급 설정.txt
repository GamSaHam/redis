
데이터 구조에 관한 설정으로서 해시, 리스트, 셋, 정렬된 셋 네가지 데이터형이 레디스에 저장될 때 지정된 조건
에 의해서 더 적은 메모리를 사용하도록 설정하는 것이다.

설정은 두 가지로 구분되는데 첫 번째는 저장될 데이터 개수에 대한 조건 두 번째는 저장될 데이터 크기에 대한 조건
두가지 조건에 만족하면 ziplist 인코딩을 사용하여 저장한다.

레디스가 ziplist 인코딩을 사용하여 데이터를 저장하면 저장되는 데이터 크기는 줄어들지만 데이터의 저장과
조회에 더 많은 CPU를 사용하게 된다.

즉, 설정값을 크게 하면 메모리 사용량은 줄어들지만 CPU 사용량은 더 늘어난다. 이 설정은 하드웨어 환경에 따라서
적절히 조절하여야 한다.

hash-max-zliplist-entries
해시 데이터에 ziplist 인코딩을 사용하여 저장할 데이터 개수를 지정한다. 여기서 지정된 개수보다 많은 데이터가
저장되면 레디스는 자동으로 hashtable 인코딩을 사용하여 저장한다.

hash-max-ziplist-value
해시 데이터에 ziplist 인코딩을 사용하여 저장할 데이터의 크기를 지정한다.

raw: 입력된 데이터를 변환하지 않고 그대로 저장하는 상태
integer: 입력된 숫자 형식의 데이터를 숫자 데이터 타입으로 저장하고 있는 상태다.
hashtable: raw 인코딩을 가진 데이터를 저장하고 있는 해시 테이블을 의미한다.
zipmap: 압축된 형태의 map구조를 표현하는 데이터 인코딩이다. 2.6이후 부터 ziplist로 통합된다.
linkedlist: raw 인코딩을 가진 데이터를 저장하고 있는 연결 리스트 의미 압축이 안됨

ziplist: 해시,셋, 정렬된 셋 데이터형이 압축된 형태의 인코딩을 의미한다.
intset: 입력된 숫자 형식의 데이터를 숫자 데이터 타입으로 변환하여 셋 데이터에 저장된 상태다.
skiplist: raw 인코딩을 가진 데이터를 저장하고 있는 정렬된 셋 데이터의 인코딩을 의미한다.

set-max-intset-entries
셋 데이터에 intset 인코딩을 사용하여 저장할 데이터 개수를 지정한다.

zset-max-ziplist-entries
정렬된 셋 데이터에 ziplist 인코딩을 사용하여 저장할 데이터 크기를 지정한다.

zset-max-ziplist-value
해시 데이터에 skiplist 인코딩을 사용하여 저장할 데이터의 크기를 지정한다.

client-output-buffer-limit
레디스 인스턴스는 접속된 클라이언트로 데이터를 전송하기 위하여 버퍼를 생성한다.

마스터 노드는 슬레이브 노드와의 연결과 클라이언트와의 연결을 모드 클라이언트 연결로 인식한다.
또한 마스터 노드는 각 클라이언트 연결에 대하여 데이터를 전송하기 위한 버퍼를 생성한다.

일반적으로 클라이언트는 데이터를 저장하고 조회하는 명령을 송수신하기 때문에 용량이 큰 데이터의 송수신은 발생
하지 않는다.

반대로 슬레이브 노드는 복제를 위해서 마스터 노드의 전체 데이터 셋을 네트워크를 통해서 전송한다.
즉, 데이터를 전송하기 위해서 큰 용량의 버퍼가 필요하게 된다.

이 슬레이브 클라이언트가 연결되면 클라이언트 마다 버퍼를 할당하여 정작 데이터를 지정할 메모리가 줄어들게 된다.

레디스는 이런 상황을 방지하기 위하여 client-output-buffer-limit 라는 설정을 제공한다.

1. Hard limit 버퍼의 크기가 Hard limit에 지정된 크기 만큼 커지면 연결된 클라이언트의 연결을 해제한다.

하나의 키에 저장된 데이터의 크기가 200MB이고 클라이언트에서이 데이터를 조회하기 위하여 get 명령을 서버로 전송했다.

이때 클라이언트 네트워크 상태가 좋지 않아서 초당 네트워크 전송률이 1MB라고 가정하면, 클라이언트에게 데이터를 전송하기

위해 200초가 소요된다. 레디스 인스턴스는 클라이언트에게 데이터를 전송하기 위하여 버퍼에 200MB를 할당하고 클

라이언트에게 데이터를 전송하기 위해서 200MB의 메로리를 버퍼 할당에 사용했기 때문에 200초 동안 200MB의 메모리가

데이터 저장에 사용되지 못한다. 

client-output-buffer-limit 설정을 한다.

normal: 레디스 명령을 송수신하기 위한 클라이언트 연결
slave: 복제를 위한 슬레이브 연결 또는 monitor 명령을 수행 중인 클라이언트 연결
pubsub: 레디스 명령을 송수신하기 위한 클라이언트 중에 pub/sub 명령을 수행 중인 연결

client-output-buffer-limit normal 0 0 0 : 버퍼의 크기에 상관없이 클라이언트의 연결을 해제 하지 않는다.

client-output-buffer-limit slave 256MB 64MB 60 : 슬레이브 노드를 위한 버퍼의 크기가 256MB까지 커지거나
64MB인 상태가 60초간 지속되면 해당 슬레이브 노드의 연결을 해제한다.

client-output-buffer-limit pubsub 32MB 8MB 60 : pub/sub 명령을 위한 버퍼의 크기가 32MB까지 커지거나
8MB인 상태가 60초간 지속되면 해당 클라이언트 연결을 해제한다.

마스터 노드에 저장된 데이터가 수십 기가바이트 이상일 때 복제를 위해서 데이터를 네트워크로 전송하면 마스터
노드는 client-output-buffer-limit slave 설정에 지정된 값에 의하여 클라이언트 연결을 해제한다.
즉, 너무 많은 네트워크 리소스를 사용하고 있으므로 강제로 연결을 해제한다.
특별한 원이 없는 상황에서 이유 없이 클라이언트의 연결이 끊어진다면 client-output-buffer-limit slave 설정을
확인하기 바란다.











