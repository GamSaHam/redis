
계층형 복제는 마스터 노드에 너무 많은 슬레이가 접속되어 쓰기 성능이 저하되는 문제점을 위한 해결하기 위한 복제
방법이다.

마스터 노드 ->(복제) 슬레이브 노드1 ->(복제) 슬레이브 노드(2,3,4)

클라이언트 ->(쓰기) 마스터 노드
클라이언트 <-(읽기) 슬레이브 노드(2,3,4)


마스터 노드와 슬레이브 노드1이 1차로 복제되어 동기화 되고, 그 이후에 슬레이브 노드 2, 슬레이브 노드 3, 슬레이브 노드 

복제 된다. 계층형 복제는 이와 같이 단계별로 복제를 수행하는데, 더 많은 읽기 성능이 필요하거나 별도의 기능을 위해서

새로운 단계의 복제 노드를 추가하기도 한다.

슬레이브 1 노드는 1차 복제를 수행하기 위해서 읽기와 쓰기 연산을 수행하지 않도록 구성되어 있다.

다중 복제에서 설명한 리소스 부족이 기 이유 인데 리소스가 충분하다면 슬레이브 노드1에서 읽기 연산을 수행하여도 무방하다.

레디스의 클러스터 구성에서는 듀얼 마스터(Dual Master) 또는 다중 마스터(Multi Master) 복제를 지원하지 않는다.

듀얼 마스터란 통상적인 클러스터 시스템 구성에서 고가용성을 지원하기 위해서 2대 이상의 노드가 마스터로 동작하는 것을 말한다.

모든 노드가 쓰기 연산을 수행하고 변경내역을 다른 마스터 노드로 전파하여 데이터를 동기화 하는 구조다.

일반적인 클러스터 시스템에서 듀얼 마스터의 쓰기 연산을 보여주는 그림 8-5를 보자


듀얼 마스터의 쓰기 연산1

클러스터

> 마스터 노드1, 마스터 노드2 

클라이언트1 ->(쓰기) 마스터 노드1
클라이언트2 ->(쓰기) 마스터 노드2

듀얼 마스터의 쓰기 연산2

클러스터

> 마스터 노드1 -> (복제요청) <-(복제요청) 마스터 노드2


실제로 레디스를 사용하여 위와 같은 듀얼 마스터 설정을 시도하는 사례가 있었고 결과는 성공한 듯했다.

이와 같은 설정은 에러 로그 없이 정상 동작하는 것처럼 보이지만 실제로는 몇 가지 부작용과 함께 정상 작동하지 않는다.

또한 최악의 경우 동일한 데이터에 대한 상호 복제를 계속 시도하는 사태가 벌어지기도 한다.

구글의 레디스 사용자 그룹에서 레디스를 위와 같은 구성으로 설정하는 것에 대한 논의가 있었으나 정상 동작하지 않는다는

레디스의 개발자의 답변이 게시됐다.

레디스의 클러스터 버전은 3.0에서 지원된다고 하지만 그전까지는 레디스의 복제와 샤딩을 사용하여 클러스터를 수동으로 구축

해 관리해야 한다.

※ 레디스 클러스터 버전
레디스 2.6 버전에서는 완벽한 클러스터를 지원하지 않는다. 완벽한 클러스터란 듀얼 마스터와 같이 고가용성과 자동 복제와 같은

클러스터 관리를 서버가 수행하는 것을 말한다.

아직까지는 레디스의 클러스터 자동화 기능과 노드의 자동 Failover 등이 제공되지 않고 있으나

레디스 3.0 버전에서 지원할 예정이다. 레디스 2013년 8월을 기준으로 다음 안정화 버전은 2.8이며, 3.0은 기 이후의 안정화

버전이다.









