레디스 구성에서 가장 많이 맞닥뜨리는 임계점 중 하나는 네트워크다.

샤드1
노드1 -> 노드2, 노드3

샤드2
노드4 -> 노드5, 노드6

[그림 9-4]

실제 하드웨어

네트워크 허브 1Gbps
->
(192.168.2.51) 노드1,
(192.168.2.52) 노드2,
(192.168.2.53) 노드3,
(192.168.2.54) 노드4,
(192.168.2.55) 노드5,
(192.168.2.56) 노드6

물리적인 구성에서 확인 가능한 병목 구간은 네트워크다.
네트워크 허브의 속도와 각 노드에 설치된 네트워크 카드의 속도를 1Gbps라고 가정하자.
1Gbps의 속도를 가진 네트워크 카드의 이론상 최대 데이터 전송률은 약 125MB이다.

실제 네트워크 하드웨어가 전송할수 있는 전송률은 약 100MB 내외이다.

각 노드당 초당 2만번의 읽기 요청을 처리할수 있고 눈리적인 구성에서 이론 적으로
처리 가능한 요청은 초당 12만 번이다.

각 요청이 평균 5KB데이터를 요청한다면 120,000 * 5 / 1,024 = 585Mb 데이터가 전송된다.

이미 네트워크 허브가 처리할 수 있는 데이터의 크기를 넘어서고 있으므로 모든 노드가 데이터를 전송하
기 위해서 대기하게 되고 6개 노드의 전체 성능을 사용하지 못하게 된다.

네트워크 허브를 10Gbps 장비로 교체했다고 가정

[그림 9-4]에서 각 마스터는 2개의 슬레이브 노드를 가지므로 쓰기 연산이 한번
발생할 때마다 2번의 추가 트래픽이 발생한다.

마스터와 슬레이브 연결이 끊어 지면 슬레이브 노드는 마스터 노드로 재접속을 시도하고
접속이 완료되면 마스터 노드의 전체 데이터를 전송받아 데이터의 동기화를 수행한다.

이때 발생하는 트래픽은 네트워크 대역폭의 대부분을 사용하게 되고 곧 임계점이 다다르게 된다.

네트워크 허브1 1Gbps
-> 읽기와 쓰기 연산
(192.168.2.51) 노드1,
(192.168.2.52) 노드2,
(192.168.2.53) 노드3,
(192.168.2.54) 노드4,
(192.168.2.55) 노드5,
(192.168.2.56) 노드6

네트워크 허브2 1Gbps
-> 관리와 복제를 위해 사용
(192.168.9.51) 노드1,
(192.168.9.52) 노드2,
(192.168.9.53) 노드3,
(192.168.9.54) 노드4,
(192.168.9.55) 노드5,
(192.168.9.56) 노드6

샤드1의 슬레이브 노드1 노드2, 노드3 설정된 redis.conf
slaveof 192.168.9.51 6379

샤드2의 슬레이브 노드4 노드5, 노드6 설정된 redis.conf
slaveof 192.168.9.54 6379

복제를 위한 데이터는 모두 네트워크 허브 2를 통하여 전송되고, 데이터의 읽기 연산과 쓰기 연산을 모두 네트워크 허브 1을 사용하여
전송된다. 즉, 이와 같이 네트워크를 구성하면 서비스를 위한 네트워크 대역폭을 분리하여 네트워크 병목현상을 피할 수 있다.


